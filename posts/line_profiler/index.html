<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.d451ff92e80abc2a828eb9bb262e4db374bd4e954642f9245c54eec84bf690f3.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Usman Mahmood - Finding Performance Issues In Python Using Line Profiler</title>
<meta property="og:title" content=Usman&#32;Mahmood&#32;-&#32;Finding&#32;Performance&#32;Issues&#32;In&#32;Python&#32;Using&#32;Line&#32;Profiler />
<meta name="twitter:title" content=Usman&#32;Mahmood&#32;-&#32;Finding&#32;Performance&#32;Issues&#32;In&#32;Python&#32;Using&#32;Line&#32;Profiler />
<meta itemprop="name" content=Usman&#32;Mahmood&#32;-&#32;Finding&#32;Performance&#32;Issues&#32;In&#32;Python&#32;Using&#32;Line&#32;Profiler />
<meta name="application-name" content=Usman&#32;Mahmood&#32;-&#32;Finding&#32;Performance&#32;Issues&#32;In&#32;Python&#32;Using&#32;Line&#32;Profiler />
<meta property="og:site_name" content="Blog" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://www.usman.me.uk/posts/line_profiler/" />
<link rel="canonical" href="https://www.usman.me.uk/posts/line_profiler/" itemprop="url" />
<meta name="url" content="https://www.usman.me.uk/posts/line_profiler/" />
<meta name="twitter:url" content="https://www.usman.me.uk/posts/line_profiler/" />
<meta property="og:url" content="https://www.usman.me.uk/posts/line_profiler/" />


<meta property="og:updated_time" content="2025-09-23T15:17:50Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://www.usman.me.uk/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



  
    <meta name="twitter:site" content="@make_slice" />
    <meta name="twitter:creator" content="@make_slice" />

<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Blog" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.152.2">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.0d70d5aed9787dcd4309c157b56a11f2811027b0be28bc951ad207bf2efd221b.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5a5a5a;
        --link-color: #268bd2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #eee;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9d9d9d;
        --link-color: #268bd2;
        --date-color: #9a9a9a;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #fff;
        --code-background-color: #515151;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://www.usman.me.uk/">
                <img src="/images/gopher.png" alt="brand image">
            </a>
        
        
            <a href="https://www.usman.me.uk/">
                <h1>Usman Mahmood</h1>
            </a>
        
    </h1>
    <p class="lead">
    Algorithms + Data Structures = Programs
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                
            
            
                
                
            
                
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/umahmood">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>





    <a target="_blank" class="social" title="X" href="https://x.com/make_slice">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" viewBox="0 0 512 472.799">
            <path fill="currentColor" d="M403.229 0h78.506L310.219 196.04 512 462.799H354.002L230.261 301.007 88.669 462.799h-78.56l183.455-209.683L0 0h161.999l111.856 147.88L403.229 0zm-27.556 415.805h43.505L138.363 44.527h-46.68l283.99 371.278z"/>
        </svg>
    </a>

















        <p class="footnote">
    <br>
    &copy; 2025 Usman Mahmood. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://www.usman.me.uk/posts/line_profiler/">Finding Performance Issues In Python Using Line Profiler</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2025-09-23T15:17:50Z" class="post-date">
        September 23, 2025
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>8 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <h2 id="overview">Overview</h2>
<ul>
<li>Line profiler is a 3rd party library available on <a href="https://github.com/pyutils/line_profiler" target="_blank">GitHub</a>.</li>
<li>Line profiler package helps in identifying the cause of CPU-bound problems in Python code.</li>
<li>Gives you a data driven approach on where to allocate your time in order to fix performance issues.</li>
<li>Understand the output of line_profiler by working through a simple code example.</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>Python has established itself as a top tier programming language. As of late 2025 according to the <a href="https://www.tiobe.com/tiobe-index/" target="_blank">TIOBE</a> index, the top 3 languages as a measure of programming language popularity, are consistently Python, C, and C++, often with Python in the lead. This popularity and increase in use of Python has been driven by fields such as machine learning, artificial intelligence and data engineering. As these fields continue to grow and so does their use of Python, the performance of code matters more than ever.</p>
<p>Your Python code is great and is functionally correct, but it may need to run faster. In this blog post, we will use the <code>line_profiler</code> package to profile CPU resource usage. Profiling allows us to find bottlenecks in our code so we can identify and correct it, and gain a practical performance gain in our code.</p>
<h3 id="about-line-profiler-package">About Line Profiler Package</h3>
<p>The line profiler package helps in identifying the cause of CPU-bound problems in Python code. It works by profiling individual functions on a line-by-line basis. Performance problems can be grouped into CPU, memory, disk IO and network IO bound problems.</p>
<p>A CPU-bound problem is one where your program&rsquo;s speed is limited by how fast the CPU can process instructions, not by waiting for I/O (disk reads, network requests, etc.). Some examples of CPU bound tasks are:</p>
<ul>
<li>Complex mathematical calculations - example when using the popular numpy library.</li>
<li>Data processing/transformations - example using pandas module to filter, aggregate, transform, and join data.</li>
<li>Image/video encoding for example - example using OpenCV to compress/encode pixels.</li>
</ul>
<h3 id="profiling-efficiently">Profiling Efficiently</h3>
<p>If your code is running slowly, you do not want to guess as to what the cause of the slowness could be. If you avoid profiling and jump straight into optimizations, then you could end up wasting your time and creating more work for yourself. Profiling takes out the guess work out of where you should allocate your time to introduce performance optimizations and gives you a data driven approach to the process.</p>
<p>Another important thing to remember when profiling is to isolate the part of the system that you need to test. Hopefully your code is modular and organised into their own modules. It is not a good idea to start profiling from the main function, as this would generate a lot of noise in the profiling data. Also, profiling adds overhead (10x to 100x slowdowns) which will affect the system under test.</p>
<p>So avoid doing this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@profile</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># implementation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>And try to extract a test case which isolates the part of the system you want to test:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@profile</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_validate_user_returns_true_for_valid_data</span>():
</span></span><span style="display:flex;"><span>    processor <span style="color:#f92672">=</span> DataProcessor()
</span></span><span style="display:flex;"><span>    user_data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#e6db74">&#39;email&#39;</span>: <span style="color:#e6db74">&#39;alice@example.com&#39;</span>}
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> processor<span style="color:#f92672">.</span>validate_user(user_data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> result <span style="color:#f92672">is</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><h2 id="using-line-profiler">Using Line Profiler</h2>
<p>Line profiler is a third party package that you can install with:</p>
<pre tabindex="0"><code>pip3 install line_profiler
</code></pre><h3 id="profiling-code">Profiling code</h3>
<p>In order to profile code, we need to:</p>
<ul>
<li>Import <code>line_profiler</code> package.</li>
<li>Add the <code>@line_profiler.profile</code> decorator to the function we want to profile.</li>
</ul>
<p>Let&rsquo;s do both of those to the code we want to profile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> line_profiler
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_random_numbers</span>():
</span></span><span style="display:flex;"><span>    nums <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>    upper_bound <span style="color:#f92672">=</span> <span style="color:#ae81ff">1_000_000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(upper_bound):
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, upper_bound)
</span></span><span style="display:flex;"><span>        nums<span style="color:#f92672">.</span>append(n)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> nums
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@line_profiler.profile</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">flux</span>(nums):
</span></span><span style="display:flex;"><span>    found <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>    upper_bound <span style="color:#f92672">=</span> <span style="color:#ae81ff">1_000_000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>):
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, upper_bound)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">in</span> nums:
</span></span><span style="display:flex;"><span>            found<span style="color:#f92672">.</span>append(n)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> found
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nums <span style="color:#f92672">=</span> get_random_numbers()
</span></span><span style="display:flex;"><span>flux(nums)
</span></span></code></pre></div><p>Save the code to file <code>main.py</code>.</p>
<p><strong>Note</strong>: The code is contrived, but we want to use a small and complete example that demonstrates how to identify, understand and fix a performance issue.</p>
<p>Let&rsquo;s run the code:</p>
<p>In order to run the code, we need to set the <code>LINE_PROFILE=1</code> environment variable as follows:</p>
<pre tabindex="0"><code>LINE_PROFILE=1 python3 main.py
</code></pre><p>When you run the code, you will see the following output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>Timer unit: 1e-09 s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  3.45 seconds - main.py:15 - flux
</span></span><span style="display:flex;"><span>Wrote profile results to profile_output.txt
</span></span><span style="display:flex;"><span>Wrote profile results to profile_output_2025-12-06T211824.txt
</span></span><span style="display:flex;"><span>Wrote profile results to profile_output.lprof
</span></span><span style="display:flex;"><span>To view details run:
</span></span><span style="display:flex;"><span>python -m line_profiler -rtmz profile_output.lprof
</span></span></code></pre></div><p>The output shows that <code>line_profiler</code> has profiled the code and found that the <code>flux</code> function (at line 15 in main.py where the decorator is located) took <strong>3.45</strong> seconds to execute. The profiler has saved detailed results to three files:</p>
<ul>
<li>profile_output.txt (human-readable)</li>
<li>profile_output_2025-12-06T211824.txt (timestamped backup)</li>
<li>profile_output.lprof (binary format)</li>
</ul>
<p>We can examine the profiling results with the following command:</p>
<pre tabindex="0"><code>python3 -m line_profiler -rtmz profile_output.lprof
</code></pre><p>The output shows detailed profiling results of the function we added our decorator to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>Timer unit: 1e-06 s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total time: 3.44566 s
</span></span><span style="display:flex;"><span>File: main.py
</span></span><span style="display:flex;"><span>Function: flux at line 15
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Line #      Hits         Time  Per Hit   % Time  Line Contents
</span></span><span style="display:flex;"><span>==============================================================
</span></span><span style="display:flex;"><span>    15                                           @line_profiler.profile
</span></span><span style="display:flex;"><span>    16                                           def flux(nums):
</span></span><span style="display:flex;"><span>    17         1          2.0      2.0      0.0      found = list()
</span></span><span style="display:flex;"><span>    18         1          0.0      0.0      0.0      upper_bound = 1_000_000
</span></span><span style="display:flex;"><span>    19      1001        527.0      0.5      0.0      for _ in range(1000):
</span></span><span style="display:flex;"><span>    20      1000       6827.0      6.8      0.2          n = random.randint(0, upper_bound)
</span></span><span style="display:flex;"><span>    21      1000    3437855.0   3437.9     99.8          if n in nums:
</span></span><span style="display:flex;"><span>    22       631        446.0      0.7      0.0              found.append(n)
</span></span><span style="display:flex;"><span>    23         1          0.0      0.0      0.0      return found
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  3.45 seconds - main.py:15 - flux
</span></span></code></pre></div><p>Let&rsquo;s understand what the columns in the profiling data mean:</p>
<ul>
<li><strong>Line #</strong> - Line number in the code.</li>
<li><strong>Hits</strong> - How many times that line executed.</li>
<li><strong>Time</strong> - Total time spent on that line (in nanoseconds).</li>
<li><strong>Per Hit</strong> - Average time per execution of that line.</li>
<li><strong>% Time</strong> - Percentage of total function time spent on that line.</li>
<li><strong>Line Contents</strong> - The actual code.</li>
</ul>
<p>In the output of the profiling data, our eye should be immediately drawn to line 21 (<code>if n in nums:</code>). The <code>% Time</code> shows that this dominates at 99.8% of execution time. Checking if a number is in the list is consuming a lot of time and is contributing immensely to the 3.45 seconds that the function is taking to execute.</p>
<h3 id="the-fix">The Fix</h3>
<p>Now that we have identified the cause of our codes bottleneck, we have to find out why this is happening.</p>
<p>What the code is doing on every iteration is generating a random number <code>n</code> and seeing if that number appears in <code>nums</code>. Importantly, <code>nums</code> is a list and checking membership in a list is <code>O(n)</code>.</p>
<p>O(n) is linear time so we start from the beginning of the list and potentially check every number to the end of the list. In a list with small numbers this would not really be an issue, but we have a list of a million numbers, and if we generate a random number say 23, and 23 is the last element in <code>nums</code>, that is a million comparisons. This is inefficient and wasting a lot of CPU time.</p>
<p>A common technique in Python is to convert lists to sets when performing membership testing. Sets in Python are implemented as hash tables, which allow for constant-time (O(1)) lookups on average. This means that checking whether <code>n</code> exists in a set is much faster, especially when dealing with sizeable datasets.</p>
<p>Let&rsquo;s update the code to switch <code>nums</code> from a list to a set:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_random_numbers</span>():
</span></span><span style="display:flex;"><span>    nums <span style="color:#f92672">=</span> set()
</span></span><span style="display:flex;"><span>    upper_bound <span style="color:#f92672">=</span> <span style="color:#ae81ff">1_000_000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(upper_bound):
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, upper_bound)
</span></span><span style="display:flex;"><span>        nums<span style="color:#f92672">.</span>add(n)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> nums
</span></span></code></pre></div><h3 id="profiling-code-change">Profiling code change</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>LINE_PROFILE=1 python3 main.py
</span></span></code></pre></div><p>Output the profiling data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>Timer unit: 1e-09 s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  0.00 seconds - main.py:15 - flux
</span></span><span style="display:flex;"><span>Wrote profile results to profile_output.txt
</span></span><span style="display:flex;"><span>Wrote profile results to profile_output_2025-12-09T142131.txt
</span></span><span style="display:flex;"><span>Wrote profile results to profile_output.lprof
</span></span><span style="display:flex;"><span>To view details run:
</span></span><span style="display:flex;"><span>python -m line_profiler -rtmz profile_output.lprof
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>python -m line_profiler -rtmz profile_output.lprof
</span></span><span style="display:flex;"><span>Timer unit: 1e-06 s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total time: 0.004835 s
</span></span><span style="display:flex;"><span>File: main.py
</span></span><span style="display:flex;"><span>Function: flux at line 15
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Line #      Hits         Time  Per Hit   % Time  Line Contents
</span></span><span style="display:flex;"><span>==============================================================
</span></span><span style="display:flex;"><span>    15                                           @line_profiler.profile
</span></span><span style="display:flex;"><span>    16                                           def flux(nums):
</span></span><span style="display:flex;"><span>    17         1          1.0      1.0      0.0      found = list()
</span></span><span style="display:flex;"><span>    18         1          1.0      1.0      0.0      upper_bound = 1_000_000
</span></span><span style="display:flex;"><span>    19      1001        277.0      0.3      5.7      for _ in range(1000):
</span></span><span style="display:flex;"><span>    20      1000       3996.0      4.0     82.6          n = random.randint(0, upper_bound)
</span></span><span style="display:flex;"><span>    21      1000        402.0      0.4      8.3          if n in nums:
</span></span><span style="display:flex;"><span>    22       627        158.0      0.3      3.3              found.append(n)
</span></span><span style="display:flex;"><span>    23         1          0.0      0.0      0.0      return found
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  0.00 seconds - main.py:15 - flux
</span></span></code></pre></div><p>A dramatic speed up! The total time spent in the <code>flux</code> function has gone from 3.45 seconds to 0.00 seconds!.</p>
<p>Converting <code>nums</code> to a set made lookups O(1), this dramatically reduced the time checking for membership.</p>
<h2 id="summary">Summary:</h2>
<p>In this post, we learned:</p>
<ul>
<li>How to install and configure <code>line_profiler</code> package.</li>
<li>Run the profiler against our code.</li>
<li>Understand the output of the profiler.</li>
<li>Identify and then fix code based on the results output from the profiler.</li>
</ul>
<p>If you think there is a bottleneck in your code, make sure you use a profiler to understand where the time/resources are being wasted. You need evidence to determine the most efficient ways to make your code run faster.</p>
<p>When writing code, try to keep it simple, readable and correct. This also means making sure you have a decent amount of unit test coverage in your code. Unit tests will help you avoid mistakes and keep your results reproducible. So when you make a change to your code after analysing profiling results, you can run your unit tests after and make sure your code is still functionally correct.</p>
<p>Thank you for reading.</p>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://www.usman.me.uk/posts/merkle-tree-verify/?ref=footer"><span style="font-weight:bold;">Â« Previous</span><br>Merkle Trees and Data Verification</a>
        
	    
    
</div>

  
</div>
            </main>
            
  

        </div>
    </body>
</html>
