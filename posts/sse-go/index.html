<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.d451ff92e80abc2a828eb9bb262e4db374bd4e954642f9245c54eec84bf690f3.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Usman Mahmood - Server-Sent Events (SSE) With Go</title>
<meta property="og:title" content=Usman&#32;Mahmood&#32;-&#32;Server-Sent&#32;Events&#32;(SSE)&#32;With&#32;Go />
<meta name="twitter:title" content=Usman&#32;Mahmood&#32;-&#32;Server-Sent&#32;Events&#32;(SSE)&#32;With&#32;Go />
<meta itemprop="name" content=Usman&#32;Mahmood&#32;-&#32;Server-Sent&#32;Events&#32;(SSE)&#32;With&#32;Go />
<meta name="application-name" content=Usman&#32;Mahmood&#32;-&#32;Server-Sent&#32;Events&#32;(SSE)&#32;With&#32;Go />
<meta property="og:site_name" content="Blog" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://www.usman.me.uk/posts/sse-go/" />
<link rel="canonical" href="https://www.usman.me.uk/posts/sse-go/" itemprop="url" />
<meta name="url" content="https://www.usman.me.uk/posts/sse-go/" />
<meta name="twitter:url" content="https://www.usman.me.uk/posts/sse-go/" />
<meta property="og:url" content="https://www.usman.me.uk/posts/sse-go/" />


<meta property="og:updated_time" content="2020-05-08T13:13:23&#43;01:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://www.usman.me.uk/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



  
    <meta name="twitter:site" content="@make_slice" />
    <meta name="twitter:creator" content="@make_slice" />

<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Blog" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.152.2">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.c1a1f3f468f1f8e5729d2e79b1812f536a2ba0be45fab2fde2a56f4614a55c86.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5a5a5a;
        --link-color: #268bd2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #eee;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9d9d9d;
        --link-color: #268bd2;
        --date-color: #9a9a9a;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #fff;
        --code-background-color: #515151;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://www.usman.me.uk/">
                <img src="/images/gopher.png" alt="brand image">
            </a>
        
        
            <a href="https://www.usman.me.uk/">
                <h1>Usman Mahmood</h1>
            </a>
        
    </h1>
    <p class="lead">
    Algorithms + Data Structures = Programs
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                
            
            
                
                
            
                
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/umahmood">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>





    <a target="_blank" class="social" title="X" href="https://x.com/make_slice">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" viewBox="0 0 512 472.799">
            <path fill="currentColor" d="M403.229 0h78.506L310.219 196.04 512 462.799H354.002L230.261 301.007 88.669 462.799h-78.56l183.455-209.683L0 0h161.999l111.856 147.88L403.229 0zm-27.556 415.805h43.505L138.363 44.527h-46.68l283.99 371.278z"/>
        </svg>
    </a>

















        <p class="footnote">
    <br>
    &copy; 2025 Usman Mahmood. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://www.usman.me.uk/posts/sse-go/">Server-Sent Events (SSE) With Go</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2020-05-08T13:13:23&#43;0100" class="post-date">
        May 8, 2020
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>3 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <p>Server-Sent Events (SSE) technology is best explained by this article on <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events" target="_blank">MDN</a>:</p>
<blockquote>
<p>The EventSource interface is used to receive Server-Sent Events. It connects to a server over HTTP and receives events in text/event-stream format without closing the connection.</p>
</blockquote>
<p>The connection is persistent and communication is one-way, from the server to the client, the client cannot push data to the server. This is unlike WebSockets where communication is bi-directional.</p>
<p>Some unique characteristics of SSE compared to WebSockets or long polling are:</p>
<ul>
<li>Communication is one-way from server to client and read-only.</li>
<li>Requests are regular HTTP requests.</li>
<li>The client will attempt auto-reconnect if the connection drops.</li>
<li>Event messages can contain id&rsquo;s, so if a client connection drops. On reconnect, it can send the last id it saw, and the server can work out the number of messages the client has missed. And push those message to the client on reconnect.</li>
</ul>
<p>There is one important fact that you should understand about SSE when used over HTTP/1 and HTTP/2, from the MDN article above:</p>
<blockquote>
<p>When not used over HTTP/2, SSE suffers from a limitation to the maximum number of open connections, which can be specially painful when opening various tabs as the limit is per browser and set to a very low number (6). The issue has been marked as &ldquo;Won&rsquo;t fix&rdquo; in Chrome and Firefox. This limit is per browser + domain, so that means that you can open 6 SSE connections across all of the tabs to <a href="https://www.example1.com" target="_blank">www.example1.com</a> and another 6 SSE connections to <a href="https://www.example2.com" target="_blank">www.example2.com</a>. (from Stackoverflow). When using HTTP/2, the maximum number of simultaneous HTTP streams is negotiated between the server and the client (defaults to 100).</p>
</blockquote>
<h4 id="sse-server">SSE Server</h4>
<p>Here is a basic example of an SSE server in Go using the <em>eventsource</em> package:</p>
<pre tabindex="0"><code>// sse_server.go
package main

import (
    &#34;fmt&#34;
    &#34;net/http&#34;
    &#34;strconv&#34;
    &#34;time&#34;

    &#34;github.com/bernerdschaefer/eventsource&#34;
)

func main() {
    es := eventsource.Handler(func(lastID string, e *eventsource.Encoder, stop &lt;-chan bool) {
        var id int64
        for {
            select {
            case &lt;-time.After(3 * time.Second):
                fmt.Println(&#34;sending event...&#34;)
                id += 1
                e.Encode(eventsource.Event{ID: strconv.FormatInt(id, 10),
                    Type: &#34;add&#34;,
                    Data: []byte(&#34;some data&#34;)})
            case &lt;-stop:
                return
            }
        }
    })
    http.HandleFunc(&#34;/events&#34;, func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set(&#34;Content-Type&#34;, &#34;text/event-stream&#34;)
        w.Header().Set(&#34;Cache-Control&#34;, &#34;no-cache&#34;)
        w.Header().Set(&#34;Connection&#34;, &#34;keep-alive&#34;)
        es.ServeHTTP(w, r)
    })
    if e := http.ListenAndServe(&#34;:9090&#34;, nil); e != nil {
        fmt.Println(e)
    }
}
</code></pre><p>The above code sets up an endpoint <em>/events</em> and pushes events to clients every three seconds.</p>
<p>Start the server:</p>
<pre tabindex="0"><code>$ go run sse_server.go
</code></pre><h4 id="sse-client">SSE Client</h4>
<p>To view events pushed by the server, we will use the excellent <a href="https://httpie.org/" target="_blank">HTTPie</a> tool:</p>
<pre tabindex="0"><code>$ http --stream http://localhost:9090/events
HTTP/1.1 200 OK
Cache-Control: no-cache
Connection: keep-alive
Content-Type: text/event-stream
Transfer-Encoding: chunked
Vary: Accept

id: 1
event: add
data: some data

id: 2
event: add
data: some data

id: 3
event: add
data: some data
</code></pre><p>An example using HTML/Javascript:</p>
<pre tabindex="0"><code>&lt;!DOCTYPE html lang=&#34;en&#34;&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;Getting server updates&lt;/h1&gt;
    &lt;div id=&#34;result&#34;&gt;&lt;/div&gt;
    &lt;script&gt;
      if(typeof(EventSource) !== &#34;undefined&#34;) {
        var source = new EventSource(&#34;http://localhost:9090/events&#34;);
        source.addEventListener(&#34;add&#34;, (message) =&gt; {
                  console.log(message)
                  document.getElementById(&#39;result&#39;).innerHTML += message.data + &#34;&lt;br&gt;&#34;;
              });
      } else {
        document.getElementById(&#34;result&#34;).innerHTML = &#34;Sorry, your browser does not support server-sent events...&#34;;
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Save the above code into file sse_client.html, and then open it in your web browser.</p>
<p>you will see the event &ldquo;some data&rdquo; being output on the page, if you check the console you will see much more detailed information about the events:</p>
<pre tabindex="0"><code>add { target: EventSource, isTrusted: true, data: &#34;some data&#34;, origin: &#34;http://localhost:9090&#34;, lastEventId: &#34;1&#34;, ports: Restricted, srcElement: EventSource, currentTarget: EventSource, eventPhase: 2, bubbles: false, … }
</code></pre><p>I hope you found this post helpful.</p>
<p>Fin</p>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://www.usman.me.uk/posts/wireguard/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Secure Tunnels with WireGuard</a>
        
	    
            <div class="next-post">
                <a href="https://www.usman.me.uk/posts/merkle-tree-verify/?ref=footer"><span style="font-weight:bold;">Next »</span><br>Merkle Trees and Data Verification</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  

        </div>
    </body>
</html>
